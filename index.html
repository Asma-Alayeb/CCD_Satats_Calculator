<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hypothesis Testing for Two-Pop-Proportions</title>
</head>
<body>
    <h1>Hypothesis Testing for Two Population Proportions</h1>

    <!-- Two Population Proportions Hypothesis Test -->
    <section class="calculator">
        <h2>Two Population Proportions Hypothesis Test</h2>
        <form id="twoProportionForm">
            <p>Number of Successes in Sample 1 (x1): <input type="text" id="x1"></p>
            <p>Sample Size 1 (n1): <input type="text" id="n1" required></p>
            <p>Sample Proportion 1 (p̂1): <input type="text" id="p1"></p>
            <p>Number of Successes in Sample 2 (x2): <input type="text" id="x2"></p>
            <p>Sample Size 2 (n2): <input type="text" id="n2" required></p>
            <p>Sample Proportion 2 (p̂2): <input type="text" id="p2"></p>
            <p>Significance Level (α): <input type="text" id="alpha" required></p>
            <p>Test Type: 
                <select id="test_type" required>
                    <option value="left">Left Tail Test</option>
                    <option value="right">Right Tail Test</option>
                    <option value="two">Two Tail Test</option>
                </select>
            </p>
            <p><button type="button" onclick="performTwoProportionTest()">Perform Hypothesis Test</button></p>
        </form>

        <p id="pooled_estimate_result"></p>
        <p id="test_statistic_result"></p>
        <p id="critical_values_result"></p>
        <p id="p_value_result"></p>
    </section>

    <!-- Confidence Interval Calculator -->
    <section class="calculator">
        <h2>Calculate Confidence Interval</h2>
        <form id="ciForm">
            <p>Sample Proportion 1 (p̂1): <input type="text" id="ci_p1" required></p>
            <p>Sample Proportion 2 (p̂2): <input type="text" id="ci_p2" required></p>
            <p>Sample Size 1 (n1): <input type="text" id="ci_n1" required></p>
            <p>Sample Size 2 (n2): <input type="text" id="ci_n2" required></p>
            <p>Confidence Level (%): <input type="text" id="ci_confidence_level" required></p>
            <button type="button" onclick="calculateConfidenceInterval()">Calculate Confidence Interval</button>
        </form>
        <p id="ci_result"></p>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstat/1.9.4/jstat.min.js"></script>
    <script>
        function roundToFour(value) {
            return Math.round(value * 10000) / 10000;
        }

        function performTwoProportionTest() {
            var x1 = document.getElementById("x1").value ? parseInt(document.getElementById("x1").value) : null;
            var n1 = parseInt(document.getElementById("n1").value);
            var p1 = document.getElementById("p1").value ? parseFloat(document.getElementById("p1").value) : null;

            var x2 = document.getElementById("x2").value ? parseInt(document.getElementById("x2").value) : null;
            var n2 = parseInt(document.getElementById("n2").value);
            var p2 = document.getElementById("p2").value ? parseFloat(document.getElementById("p2").value) : null;

            var alpha = parseFloat(document.getElementById("alpha").value);
            var testType = document.getElementById("test_type").value;

            if (isNaN(n1) || isNaN(n2) || isNaN(alpha) || n1 <= 0 || n2 <= 0) {
                alert("Please ensure all required inputs are valid numbers.");
                return;
            }

            if (!x1 && !p1) {
                alert("Please provide either the number of successes (x1) or the sample proportion (p1) for Sample 1.");
                return;
            }

            if (!x2 && !p2) {
                alert("Please provide either the number of successes (x2) or the sample proportion (p2) for Sample 2.");
                return;
            }

            if (x1 !== null) {
                p1 = x1 / n1;
            }
            if (x2 !== null) {
                p2 = x2 / n2;
            }

            var p_combined = roundToFour((p1 * n1 + p2 * n2) / (n1 + n2));

            var standardError = roundToFour(Math.sqrt(p_combined * (1 - p_combined) * (1/n1 + 1/n2)));
            var testStatistic = roundToFour((p1 - p2) / standardError);

            var criticalValueLower, criticalValueUpper, pValue;
            if (testType === "left") {
                criticalValueLower = roundToFour(jStat.normal.inv(alpha, 0, 1));
                pValue = roundToFour(jStat.normal.cdf(testStatistic, 0, 1));
            } else if (testType === "right") {
                criticalValueUpper = roundToFour(jStat.normal.inv(1 - alpha, 0, 1));
                pValue = roundToFour(1 - jStat.normal.cdf(testStatistic, 0, 1));
            } else {
                criticalValueLower = roundToFour(jStat.normal.inv(alpha / 2, 0, 1));
                criticalValueUpper = roundToFour(jStat.normal.inv(1 - alpha / 2, 0, 1));
                pValue = roundToFour(2 * (testStatistic < 0 ? jStat.normal.cdf(testStatistic, 0, 1) : 1 - jStat.normal.cdf(testStatistic, 0, 1)));
            }

            document.getElementById("pooled_estimate_result").innerHTML = "Pooled Estimate (p̂): " + p_combined;
            document.getElementById("test_statistic_result").innerHTML = "Test Statistic (z): " + testStatistic;
            if (testType === "two") {
                document.getElementById("critical_values_result").innerHTML = "Critical Values: [" + criticalValueLower + ", " + criticalValueUpper + "]";
            } else {
                document.getElementById("critical_values_result").innerHTML = "Critical Value: " + (testType === "left" ? criticalValueLower : criticalValueUpper);
            }
            document.getElementById("p_value_result").innerHTML = "P-Value: " + pValue;
        }

        function calculateConfidenceInterval() {
            var p1 = parseFloat(document.getElementById("ci_p1").value);
            var p2 = parseFloat(document.getElementById("ci_p2").value);
            var n1 = parseInt(document.getElementById("ci_n1").value);
            var n2 = parseInt(document.getElementById("ci_n2").value);
            var confidenceLevel = parseFloat(document.getElementById("ci_confidence_level").value) / 100;

            if (isNaN(p1) || isNaN(p2) || isNaN(n1) || isNaN(n2) || isNaN(confidenceLevel)) {
                alert("Please ensure all inputs are valid numbers.");
                return;
            }

            var zScore = roundToFour(jStat.normal.inv(1 - (1 - confidenceLevel) / 2, 0, 1));
            var standardError = roundToFour(Math.sqrt((p1 * (1 - p1) / n1) + (p2 * (1 - p2) / n2)));
            var marginOfError = roundToFour(zScore * standardError);

            var lowerBound = roundToFour((p1 - p2) - marginOfError);
            var upperBound = roundToFour((p1 - p2) + marginOfError);

            document.getElementById("ci_result").innerHTML = 
                "Confidence Interval: [" + lowerBound + ", " + upperBound + "]<br>Margin of Error: " + marginOfError;
        }
    </script>
</body>
</html>
